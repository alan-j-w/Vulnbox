{% extends 'base.html' %}
{% load static %}

{% block title %}Success! | VulnBox{% endblock %}

{% block extra_head %}
<style>
    .success-container {
        max-width: 800px;
        margin: 5% auto;
        text-align: center;
        font-family: 'Courier New', monospace;
    }

    /* --- FAKE TERMINAL --- */
    .terminal {
        background-color: #000;
        border: 2px solid #0f0;
        border-radius: 8px;
        padding: 2rem;
        text-align: left;
        box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
        margin-bottom: 2rem;
    }

    .terminal p {
        margin: 0 0 10px 0;
        color: #0f0;
        white-space: nowrap;
        overflow: hidden;
        width: 0;
        animation: typing 2s steps(30, end) forwards;
    }

    /* Stagger the animation for each line */
    .terminal p:nth-child(2) { animation-delay: 2s; }
    .terminal p:nth-child(3) { animation-delay: 4s; }

    .flag-line {
        color: #a8ffb9;
        font-size: 1.5rem;
        font-weight: bold;
        text-shadow: 0 0 10px #0f0;
        animation-delay: 6s !important;
    }

    @keyframes typing {
        from { width: 0; }
        to { width: 100%; }
    }

    /* --- DEBRIEF SECTION --- */
    details {
        background: rgba(0, 255, 0, 0.05);
        border: 1px solid #0f0;
        border-radius: 8px;
        margin-top: 1rem;
        text-align: left;
    }
    summary {
        padding: 1rem;
        color: #0f0;
        font-weight: bold;
        cursor: pointer;
        outline: none;
    }
    summary::before {
        content: '[+] ';
    }
    .debrief-content {
        padding: 0 1.5rem 1.5rem 1.5rem;
        color: #ccc;
        line-height: 1.6;
    }
    
    /* --- NAVIGATION BUTTONS --- */
    .nav-buttons {
        margin-top: 2rem;
        display: flex;
        justify-content: center;
        gap: 1rem;
    }
    .nav-button {
        background: transparent;
        border: 2px solid #0f0;
        color: #0f0;
        padding: 10px 20px;
        text-decoration: none;
        border-radius: 8px;
        font-weight: bold;
        transition: all 0.3s ease;
    }
    .nav-button:hover {
        background: #0f0;
        color: #000;
        box-shadow: 0 0 15px #0f0;
    }

</style>
{% endblock %}

{% block content %}
<div class="success-container">

    <div class="terminal">
        <!-- âœ… FIX: These messages are now dynamic -->
        <p>{{ line_1_message|default:"> EXECUTING PAYLOAD..." }}</p>
        <p>{{ line_2_message|default:"> TARGET COMPROMISED..." }}</p>
        <p class="flag-line">> FLAG RETRIEVED: {{ flag }}</p>
    </div>

    <details>
        <summary>Vulnerability Explained: How It Worked</summary>
        <div class="debrief-content">
            <p>{{ vulnerability_explanation }}</p>
        </div>
    </details>

    <details>
        <summary>Remediation: How to Fix It</summary>
        <div class="debrief-content">
            <p>{{ remediation_explanation }}</p>
        </div>
    </details>

    <div class="nav-buttons">
       <a href="{% url 'core:dashboard' %}" class="nav-button">Back to Dashboard</a>
       <a href="{% url return_url_name %}" class="nav-button">Return to Course</a>
    </div>

</div>
{% endblock %}
